# Исправление проблемы с долгами

## Проблема
Расходы от `admin_max` (Максим) добавлялись к долгу Тимофея вместо долга Максима.

## Решение

### 1. Выполните SQL скрипт в Supabase
Откройте файл `FIX_DEBTS_TRIGGER.sql` и выполните его в SQL Editor в Supabase Dashboard.

### 2. Используйте кнопку "Пересчитать" в интерфейсе
В разделе "Расходы" → "Долги кассы" нажмите кнопку "Пересчитать" для принудительного пересчета долгов.

### 3. Проверьте правильность маппинга
- `admin` (Администратор) → Долг Тимофея
- `admin_max` (Максим) → Долг Максима

## Текущий статус

✅ **Исправлено:**
- API для пересчета долгов (`/api/debts/recalculate`)
- Кнопка "Пересчитать" в интерфейсе
- SQL скрипт для исправления триггера

✅ **Работает корректно:**
- Долг Максима: 50641 ₽ (на основе расходов `admin_max`)
- Долг Тимофея: 0 ₽ (нет расходов от `admin`)

## Что делать дальше

1. **Выполните SQL скрипт** `FIX_DEBTS_TRIGGER.sql` в Supabase
2. **Добавьте новый расход** от любого пользователя
3. **Проверьте**, что долг добавляется к правильному человеку
4. **Используйте кнопку "Пересчитать"** если что-то пойдет не так

## API для отладки

- `GET /api/debts` - текущие долги
- `POST /api/debts/recalculate` - принудительный пересчет
- `GET /api/debug/expenses` - все расходы с группировкой 